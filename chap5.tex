
\chapter{Differentiation}

\section{The Derivative of a Real Function}

\begin{definition} % Definition 5.1
    Let $f: [a, b] \to \R$. Then for any $x \in [a, b]$, define
    \[
        \phi(t) = \frac{f(t) - f(x)}{t - x}
    \]
    and
    \[
        f'(x) = \lim_{t \to x} \phi(t) = \lim_{t \to x} \frac{f(t) - f(x)}{t - x}.
    \]
    given the limit exists. This $f'$, whose domain is exactly the set of points $x$ where the above limit exists, is called the \textbf{derivative} of $f$.

    If $f'$ is defined at $x$, we say $f$ is \textbf{differentiable} at $x$. If $f$ is differentiable at every point of a set $E \subseteq [a, b]$, we say $f$ is differentiable on $E$. Extending the above limit definition with left-hand and right-hand limits, we get the left-hand and right-hand derivatives, respectively. Notice thus that $f'$ is not defined on the endpoints $a$ nor $b$.
\end{definition}

\begin{theorem} % Theorem 5.2
    Let $f : [a, b] \to \R$ be differentiable at $x \in (a, b)$. Then $f$ is continuous at $x$. 

    \begin{proof}
        As $t \to x$, we have
        \[
            f(t) - f(x) = \frac{f(t) - f(x)}{t - x} \cdot (t - x) \to f'(x) \cdot 0 = 0.
        \]
    \end{proof}

    Notice that the converse is not true: consider $f(x) = |x|$ on $[-1, 1]$.
\end{theorem}

\begin{theorem} % Theorem 5.3
    Suppose $f, g$ are defined on $[a, b]$ and differentiable at $x \in [a, b]$. Then $f + g, fg, f / g$ are differentiable at $x$, and
    \begin{enumerate}[(a)]
        \item $(f + g)'(x) = f'(x) + g'(x)$;
        \item $(fg)'(x) = f'(x) g(x) + f(x) g'(x)$;
        \item $(f/g)'(x) = \frac{f'(x) g(x) - f(x) g'(x)} {g^2(x)}$.
    \end{enumerate}
    
    \begin{proof}
        (a) follows from properties of limits. (b) follows from writing
        \[
            \frac{(fg)(t) - (fg)(x)}{t - x} = \frac{f(t) [g(t) - g(x)] + [f(t) - f(x)] g(x)}{t - x} \to f(x) g'(x) + f'(x) g(x).
        \]
        Similarly, (c) follows from writing
        \[
            \frac{(f/g)(t) - (f/g)(x)} = \frac{1}{g(t) g(x)} \left[g(x) \frac{f(t) - f(x)}{t - x} - f(x) \frac{g(t) - g(x)}{t - x} \right] \to \frac{f'(x) g(x) - f(x) g'(x)} {g^2(x)}.
        \]
    \end{proof}
\end{theorem}

It can be shown inductively that polynomials are differentiable, and that $(x^n)' = nx^{n-1}$. Also, 5.3(c) shows that rational functions are differentiable, except at points where the denominator is zero.

\begin{theorem} % Theorem 5.5
    Suppose $f: [a, b] \to \R$ is continuous on $[a, b]$ and differentiable at $x \in [a, b]$. Also, suppose $g$ is defined on an interval $I$ containing the range of $f$ and differentiable at $f(x)$. Then, $(g \circ f)'(x) = g'(f(x)) f'(x)$.
    
    \begin{proof}
        We have
        \[
            \frac{h(t) - h(x)}{t - x} = \frac{g(f(t)) - g(f(x))}{t - x} = \frac{g(f(t)) - g(f(x))}{f(t) - f(x)} \cdot \frac{f(t) - f(x)}{t - x} \to g'(f(x)) f'(x)
        \]
        where the first term converges since $f(t) \to f(x)$ as $f$ is continuous. 
    \end{proof}
\end{theorem}

\section{Mean Value Theorems}

\begin{definition} % Definition 5.7
    Let $f$ be a real-valued function on a metric space $X$. We say $f$ has a \textbf{local maximum} at a point $p \in X$ when there exists $\delta > 0$ such that $f(q) \le f(p)$ for all $q \in N_\delta(p)$. A \textbf{local minimum} is defined similarly.
\end{definition}

\begin{theorem} % Theorem 5.8
    Let $f: [a, b] \to \R$ with a local maximum at $x \in (a, b)$. If $f'(x)$ exists, then $f'(x) = 0$.

    \begin{proof}
        Define $f$ and $x$ as above, and suppose $f'(x)$ exists. If $f'(x) = c > 0$, then there must exist some $y > x$ sufficiently close (say, at most $\delta$ away) from $x$ such that $\phi(y) > 0$ but this implies $f(y) > f(x)$, a contradiction. The argument against $f'(x) < 0$ is symmetric.
    \end{proof}
\end{theorem}

\begin{theorem}[Cauchy's MVT] % Theorem 5.9
    If $f, g$ are continuous real functions on $[a, b]$ which are differentiable on $(a, b)$, then there is a point $x \in (a, b)$ at which
    \[
        [f(b) - f(a)] g'(x) = [g(b) - g(a)] f'(x).
    \]
    Notice that differentiability is not required at the endpoints.

    \begin{proof}
        Let $h(x) = [f(b) - f(a)] g(x) - [g(b) - g(a)] f(x)$. It suffices to show that $h'(x) = 0$ for some $x \in (a, b)$. Notice that $h(a) = h(b)$. If $h$ is constant on $[a, b]$, then $h'(x) = 0$ everywhere. Otherwise, $h$ admits a local extremum, and thus has derivative $0$ at that extremum, completing the proof.
    \end{proof}
\end{theorem}

\begin{corollary}[Mean Value Theorem] % Theorem 5.10
    If $f: [a, b] \to \R$ is differentiable on $(a, b)$, then 
    \[
        f(b) - f(a) = (b - a) f'(x)
    \]
    for some $x \in (a, b)$.

    \begin{proof}
        Take $g(x) = x$.
    \end{proof}
\end{corollary}

\begin{theorem} % Theorem 5.11
    Suppose $f$ is differentiable in $(a, b)$.
    \begin{enumerate}[(a)]
        \item If $f' \ge 0$ on $(a, b)$, then $f$ is monotonically non-decreasing.
        \item If $f' = 0$ on $(a, b)$, then $f$ is constant.
        \item If $f' \le 0$ on $(a, b)$, then $f$ is monotonically non-increasing.
    \end{enumerate}

    \begin{proof}
        For any pair $a \le x < y \le b$, there exists some $z \in (x, y)$ such that $f'(z) (y - x) = f(y) - f(x)$, so each result follows trivially.
    \end{proof}
\end{theorem}

\section{The Continuity of Derivatives}

We have seen that derivatives need not be continuous, but the following theorem states they still have the intermediate value property:

\begin{theorem}[Darboux property of derivatives] % Theorem 5.12
    Suppose $f: [a, b] \to \R$ is differentiable and $f'(a) < \lambda < f'(b)$. Then, there exists a point $x \in (a, b)$ such that $f'(x) = \lambda$.
    
    \begin{proof}
        Let $h(t) = f(t) - \lambda t$, and notice that $h'(a) = f'(a) - \lambda < 0$ and similarly $h'(b) > 0$. Then there exist $a < s < t < b$ such that $h(s) < h(a)$ and $h(t) < h(b)$. Then $h$ is continuous on the compact interval $[s, t]$ and thus attains a minimum at $u \in (s, t)$. Then $h'(u) = 0$ so $f'(u) = \lambda$ as required. 
    \end{proof}
\end{theorem}

\begin{corollary} 
    If $f$ is differentiable on $[a, b]$, then $f'$ has no simple discontinuities on $[a, b]$. (Discontinuities of the second kind as still possible)
\end{corollary}

\section{L'Hopital's Rule}

\begin{theorem}[L'Hopital's Rule] % Theorem 5.13
    Suppose $f, g$ are real and differentiable in $(a, b)$ and $g'(x) \ne 0$ for all $x \in (a, b)$ with $-\infty \le a < b \le +\infty$. Suppose $f'(x) / g'(x) \to A$ as $x \to a$.

    If $f(x) \to 0$ and $g(x) \to 0$ as $x \to a$, OR $g(x) \to +\infty$ as $x \to a$, then $f(x) / g(x) \to A$ as $x \to a$.

    \begin{proof}
        If $A < r < q < +\infty$, then we find $c_2$ such that $f(x) / g(x) < q$ for all $x \in (a, c_2)$. Repeating the argument to find $c_3$ such that $p < f(x) / g(x)$ for $x \in (a, c_3)$ completes the argument.

        Notice that since $f'(x) / g'(x) \to A$, we can find $c$ sufficiently close to $a$ such that $f'(x) / g'(x) < r$ for $x \in (a, c)$. Furthermore, 
        \[
            \frac{f(x) - f(y)}{g(x) - g(y)} = \frac{f'(t)}{g'(t)} < r
        \]
        for some $t \in (x, y) \subseteq (a, c)$ if $a < x < y < c$. If $f(x), g(x) \to 0$, then the previous expression becomes $f'(t) / g'(t) < r$ for all $t \in (a, c)$. Otherwise, if $g(x) \to +\infty$, then we can find $a < c_1 < y$ such that $g(x) > g(y)$ and $g(x) > 0$ whenever $x \in (a, c_1)$. Multiplying the previous expression by $[g(x) - g(y)] / g(x)$, we obtain
        \[
            \frac{f(x)}{g(x)} < r - r\frac{g(y)}{g(x)} + \frac{f(y)}{g(x)},\ x \in (a, c_1).
        \]
        If we let $x \to a$, then we can find $c_2$ such that $f(x) / g(x) \le r < q$ whenever $x \in (a, c_2)$, as required. This completes the proof.
    \end{proof}
\end{theorem}

\section{Derivatives of Higher Order}

\begin{definition} % Definition 5.14
    If $f$ has a derivative $f'$ on aninterval, and $f'$ is itself differentiable, then we denote the derivative of $f'$ as $f''$ and call $f''$ the \textbf{second derivative} of $f$. Proceeding this way, we can define 
    \[
        f, f', f'', f^{(3)}, \dotsc, f^{(n)},
    \]
    each of which is the derivative of the preceding one. $f^{(n)}$ is called the \textbf{$n$-th derivative}, or the \textbf{derivative of order $n$}, of $f$.
\end{definition}

\section{Taylor's Theorem}

\begin{theorem}[Taylor's Theorem] % Theorem 5.15
    Suppose $f: [a, b] \to \R$, $n \in \N$, $f^{n-1}$ is continuous on $[a, b]$, $f^{(n)}$ exists for every $t \in (a, b)$. Let $\alpha, \beta$ be distinct points of $[a, b]$ and define
    \[
        P(t) = \sum_{k=0}^{n-1} \frac{f^{(k)}(\alpha)}{k!} (t - \alpha)^k.
    \]
    Then there exists a point $x$ between $\alpha$ and $\beta$ such that
    \[
        f(\beta) = P(\beta) + \frac{f^{(n)}(x)}{n!} (\beta - \alpha)^n.
    \]

    Notice that $n = 1$ is the Mean Value Theorem, and in general that $f$ can be approximated by a polynomial of degree $n - 1$, and that we can estimate the error given we can bound $|f^{(n)}(x)|$.

    \begin{proof}
        Let $M \in \R$ such that $f(\beta) = P(\beta) + M(\beta - \alpha)^n$, and take $g(t) = f(t) - P(t) - M(t - \alpha)^n$. Then, since $P(t)$ is a polynomial of degree $n - 1 < n$, 
        \[
            g^{(n)}(t) = f^{(n)}(t) - n! M.
        \]
        But now $g(\alpha) = g'(\alpha) = \dotsb = g^{(n-1)}(\alpha)$ from the definition of $g$ and $P$, and also $g(\beta) = 0$ by our definition of $M$. Thus, by the Mean Value Theorem, $g'(x_1) = 0$ for some $x_1 \in (\alpha, \beta)$. Similarly, $g^{(i)}(x_i) = 0$ for some $x_i \in (\alpha, x_{i-1})$. Thus, $g^{(n)}(x_n) = 0$ for some $x_n \in (\alpha, x_{n-1}) \subseteq (\alpha, \beta)$, so in particular,
        \[
            M = \frac{f^{(n)}(x_n)}{n!},
        \]
        as required.
    \end{proof}
\end{theorem}

\section{Differentiation of Vector-Valued Functions}

To extend our definition of differentiation to vector-valued functions, we write
\[
    \textbf{f}'(x) = \lim_{t \to x} \frac{\textbf{f}(t) - \textbf{f}(x)}{t - x} \in \R^k,
\]
where the limit is taken with the norm in $\R^k$.

If $f_1, \dotsc, f_k$ are the components of $\textbf{f}$, then $\textbf{f}' = (f_1', f_2', \dotsc, f_k')$, and $\textbf{f}$ is differentiable at a point $x$ iff each component is differentiable at $x$.

Also,
\[
    (\textbf{f} \cdot \textbf{g})'(x) = \textbf{f}'(x) \cdot \textbf{g}(x) + \textbf{f}(x) \cdot \textbf{g}'(x).
\]
ie. the product rule works with the multiplies replaced with dot products.

Notice that the mean value theorem no longer holds in general: consider $f(x) = e^{ix}$, where $f(0) = f(2\pi)$, but $f'(x) = ie^{ix} \ne 0$ for $x \in \R$.

Also, L'Hopital's rule fails: define $f(x) = x$ and $g(x) = x + x^2 e^{i/x^2}$. Then $\lim_{x \to 0} f(x)/g(x) = 1$ but $\lim_{x \to 0} f'(x) / g'(x) = 0 \ne 1$.

However, there is a consequence of the mean value theorem which is almost as useful as Theorem 5.10:

\begin{theorem} % Theorem 5.19
    Suppose $\textbf{f}: [a, b] \to \R^k$ is continuous on $[a, b]$ and differentiable in $(a, b)$. Then, there exists $x \in (a, b)$ such that
    \[
        |\textbf{f}(b) - \textbf{f}(a)| \le (b - a) |\textbf{f}'(x)|.
    \]
    
    \begin{proof}
        Let $\textbf{z} = \textbf{f}(b) - \textbf{f}(a)$ and $\phi(t) = \textbf{z} \cdot \textbf{f}(t)$. Then $\phi$ is continuous on $[a, b]$ and differentiable on $(a, b)$. Then, the Mean Value Theorem tells us that
        \[
            |\textbf{z}|^2 = \phi(b) - \phi(a) = (b - a) \phi'(x) = (b - a) \textbf{z} \cdot \textbf{f}'(x),
        \]
        for some $x \in (a, b)$. Then Cauchy-Schwartz yields
        \[
            |\textbf{z}|^2 = (b - a) |\textbf{z} \cdot \textbf{f'}(x)| \le (b - a) |\textbf{z}| |\textbf{f}'(x)|
        \]
        and the result follows.
    \end{proof}
\end{theorem}

\section{Exercises}

\begin{enumerate}[1.]
\item % Exercise 1
Let $f: \R \to \R$ and $|f(x) - f(y)| \le (x - y)^2$ for all $x, y \in \R$. Prove that $f$ is constant.

\begin{proof}
    Let $x \in \R$ be arbitrary. Then, we can find a sequence of rational numbers $p_n/q_n$ converging to $x$ such that $(p_n-1)/q_n \le x < p_n/q_n$ for each $n$. Without loss of generality (multiplying $p_n$ and $q_n$ by some positive integer otherwise), suppose that $q_n$ is a strictly increasing sequence. However,
    \begin{align*}
        |f(x) - f(0)| &\overset{\Delta}{\le} \left|f(x) - f\left(\frac{p_n}{q_n}\right)\right| + \left|f\left(\frac{p_n}{q_n}\right) - f\left(\frac{p_n-1}{q_n}\right)\right| + \dotsb + \left|f\left(\frac{1}{q_n}\right) - f(0)\right| \\
            &\le 1/q_n^2 + \underbrace{1/q_n^2 + \dotsc + 1/q_n^2}_{p_n \text{ times}} \\
            &= \frac{1}{q_n} \left(\left(\frac{p_n}{q_n}\right) + \frac{1}{q_n} \right) \le \frac{1}{q_n} \left(x + \frac{2}{q_n}\right) \le \frac{1}{n} \left(x + \frac{2}{n} \right) \to 0. 
    \end{align*}
    so taking the limit yields $|f(x) - f(0)| = 0$ so $f$ is constant, as required.
\end{proof}

\item % Exercise 2
    Suppose $f'(x) > 0$ in $(a, b)$. Prove that $f$ is strictly increasing in $(a, b)$, and let $g$ be its inverse function. Prove that $g$ is differentiable, and that
    \[
        g'(f(x)) = \frac{1}{f'(x)},\ x \in (a, b).
    \]
    
    \begin{proof}
        Take $x < y$ in $(a, b)$. Then, by the mean value theorem, there exists some $z \in (x, y)$ such that
        \[
            \frac{f(y) - f(x)}{y - x} = f'(z) > 0,
        \]
        so $f(y) > f(x)$, so $f$ is strictly increasing. Thus, $f$ is continuous and strictly increasing, so it has an inverse $g$. Then $g(f(x)) = x$ so applying the chain rule yields
        \[
            1 = (g \circ f)'(x) = g'(f(x)) \cdot f'(x)
        \]
        and thus the result.
    \end{proof}

\item % Exercise 3
    Suppose $g: \R \to \R$ has bounded derivative, say $|g'| \le M$. Fix $\epsilon > 0$ and define $f(x) = x + \epsilon g(x)$. Prove that $f$ is one-to-one for sufficiently small $\epsilon$.
    
    \begin{proof}
        If $M = 0$, this is trivial. Otherwise, choose $\epsilon < 1/M$ so that $f'(x) = 1 + \epsilon g'(x) \ge 1 + \epsilon (-M) > 0$, and thus $f$ is strictly increasing and thus one-to-one.
    \end{proof}

\item % Exercise 4
    If
    \[
        C_0 + \frac{C_1}{2} + \dotsc + \frac{C_{n-1}}{n} + \frac{C_n}{n + 1} = 0,
    \]
    prove that the polynomial $f(x) = \sum_{i=0}^{n} C_ix^i$ has at least one real root between 0 and 1.

    \begin{proof}
        Let 
        \[
            g(x) = \sum_{i=0}^{n} \frac{C_i}{i+1} x^{i+1}
        \]
        and notice that $g'(x) = f(x)$. Then, the identity gives $g(0) = g(1) = 0$, so the result follows by the mean value theorem.
    \end{proof}

\item % Exercise 5
    Suppose $f$ is defined and differentiable for every $x > 0$, and $f'(x) \to 0$ as $x \to +\infty$. Define $g(x) = f(x + 1) - f(x)$. Prove that $g(x) \to 0$ as $x \to +\infty$.

    \begin{proof}
        Let $x_n$ such that $|f'(x)| \le 1/n$ for all $x \ge x_n$, since $f'(x) \to 0$. Then, by the mean value theorem, we can find $z \in (y, y + 1) \subseteq (x_n, +\infty)$ such that 
        \[
            1/n \ge |f'(z)| = \left|\frac{f(y + 1) - f(y)}{y + 1 - y}\right| = |g(y)|
        \]
        so $|g(y)| \le 1/n$ for all $y > x_n$, proving the result.
    \end{proof}

\item % Exercise 6
    Suppose $f$ is continuous for $x \ge 0$ and differentiable for $x > 0$, $f(0) = 0$ and $f'$ is monotonically increasing. Put $g(x) = f(x) / x$ for $x > 0$ and prove that $g$ is monotonically increasing.

    \TODO
\item % Exercise 7

\item % Exercise 8
\item % Exercise 9
\item % Exercise 10
\item % Exercise 11
\item % Exercise 12
\item % Exercise 13
\item % Exercise 14
\item % Exercise 15
\item % Exercise 16
\item % Exercise 17
\item % Exercise 18
\item % Exercise 19
\item % Exercise 20
\item % Exercise 21
\item % Exercise 22
\item % Exercise 23
\item % Exercise 24
\item % Exercise 25
\item % Exercise 26
\item % Exercise 27
\item % Exercise 28
\item % Exercise 29

\end{enumerate}
